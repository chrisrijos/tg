<link rel="import" href="/resources/polymer/polymer/polymer.html">

<link rel="import" href="/app/tg-reflector.html">
<link rel="import" href="/resources/layout/tg-flex-layout.html">
<link rel="import" href="/resources/components/tg-tooltip-behavior.html">

<link rel="import" href="/resources/polymer/paper-icon-button/paper-icon-button.html">

<link rel="import" href="/resources/polymer/paper-button/paper-button.html">
<link rel="import" href="/resources/polymer/paper-dialog/paper-dialog.html">
<link rel="import" href="/resources/polymer/neon-animation/animations/scale-up-animation.html">
<link rel="import" href="/resources/polymer/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="/resources/polymer/paper-styles/paper-styles.html">
<link rel="import" href="/resources/polymer/paper-styles/color.html">

<link rel="import" href="/resources/polymer/paper-dialog-scrollable/paper-dialog-scrollable.html">

<dom-module id="tg-abstract-criterion">
    <style>
        .buttons paper-button.blue 
            color: var(--paper-light-blue-500);
            --paper-button-flat-focus-color: var(--paper-light-blue-50);
        }
        .buttons paper-button.blue:hover {
            background: var(--paper-light-blue-50);
        }
        .metavalue-editor {
            padding-top: 15px;
        }
        .mnemonic-layer, .criterion-container ::content .mnemonic-layer {
            margin-bottom: 8px;
            margin-top: 28px;
        }
        .criterion-container ::content .date-mnemonic {
            background-color: var(--paper-blue-100);
            opacity: 0.95;
            color: var(--paper-blue-800);
            pointer-events: auto;
        }
        .or-null {
            background-color: var(--paper-blue-900);
            opacity: 0.3;
            pointer-events: none;
        }
        .not {
            background-color: var(--paper-red-300);
            opacity: 0.5;
            pointer-events: none;
        }
        .criterion-container ::content .exclusive-mnemonic {
            background-color: var(--paper-blue-200);
            opacity: 0.5;
            pointer-events: none;
        }
        .crossed { /* look at https://stackoverflow.com/questions/18012420/draw-diagonal-lines-in-div-background-with-css */
            background: linear-gradient(to top left,
                rgba(0,0,0,0) 0%,
                rgba(0,0,0,0) calc(50% - 0.8px),
                rgba(0,0,0,1) 50%,
                rgba(0,0,0,0) calc(50% + 0.8px),
                rgba(0,0,0,0) 100%
            );
            pointer-events: none;
        }
    </style>
    <template>
        <tg-reflector id="reflector"></tg-reflector>
        <div class="layout horizontal justified flex end">
            <div class="criterion-container relative layout horizontal justified flex end">
                <content select=".criterion-editors" id="components"></content>
                <content select=".date-mnemonic"></content>
                <div id ="or_null_layer" class="fit mnemonic-layer or-null" hidden$="[[!_orNullVisible(critOnly, _orNull)]]"></div>
                <div id ="not_layer" class="fit mnemonic-layer not" hidden$="[[!_notVisible(critOnly, _not)]]"></div>
                <div id ="crossed_layer" class="fit mnemonic-layer crossed" hidden$="[[!_notVisible(critOnly, _not)]]"></div>
            </div>
            <paper-icon-button id="iconButton" on-tap="_showMetaValuesEditor" icon="more-vert" tooltip-text="Show additional criteria constraints"></paper-icon-buton>
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'tg-abstract-criterion',

        properties: {
            _cancelMetaValues: Function,
            _acceptMetaValues: Function,
            _showMetaValuesEditor: Function,
            _computeIconButtonStyle: Function,
            
        	_orNull: {
        		type: Boolean,
        		notify: true
        	},
        	_not: {
        		type: Boolean,
        		notify: true
        	},
        	
        	_exclusive: {
        		type: Boolean,
        		notify: true
        	},
        	_exclusive2: {
        		type: Boolean,
        		notify: true
        	},
        	
            /**
             * Indicates whether criterion for entity property has critOnly annotation or not.
             */
            critOnly: {
                type: Boolean
            }
        },
        
        behaviors: [Polymer.TgBehaviors.TgTooltipBehavior],
        
        attached: function () {
            // we need to use this trick to enforce invisibility after component has been attached... simple attribute binding does not work
            this.$.or_null_layer.hidden = !this._orNullVisible(this.critOnly, this._orNull);
            this.$.not_layer.hidden = !this._notVisible(this.critOnly, this._not);
            this.$.crossed_layer.hidden = !this._notVisible(this.critOnly, this._not);
        },
        
        /**
         * Returns 'true' if orNull meta value exists and date layer should be present, 'false' otherwise.
         */
        _orNullVisible: function (critOnly, _orNull) { 
            return critOnly === false && _orNull === true;
        }, 
        
        /**
         * Returns 'true' if 'not' meta value exists and date layer should be present, 'false' otherwise.
         */
        _notVisible: function (critOnly, _not) {
            return critOnly === false && _not === true;
        }
    });
</script>