<script>
    
    /**
     * 
     */
    const FOCUSABLE_ELEMENTS_SELECTOR = 'a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex="0"], [contenteditable]';
    /**
     * Removes all Light DOM children from Polymer 'element'.
     *
     * The need for such utility method arose from the fact that Polymer (currently 1.4 version) returns
     * from Polymer.dom(element).childNodes, Polymer.dom(element).firstChild, Polymer.dom(element).firstElementChild methods
     * not only Light DOM children, but also Local DOM children, including the elements in the template and whitespace
     * nodes in the template.
     *
     * Please, note that Polymer.dom().flush() call is needed to be done manually after this method has been used.
     * The intention was made for the cases, where some additional DOM manipulation is needed, and in such cases
     * flush() call could be efficiently done after all DOM manipulation once.
     */
    const _removeAllLightDOMChildrenFrom = function (element) {
        const childNodes = Polymer.dom(element).childNodes;
        for (let index = 0; index < childNodes.length; index++) {
            const child = childNodes[index];
            if (Polymer.dom(child).parentNode === element) {
                Polymer.dom(element).removeChild(child);
            }
        }
    };
    /**
     * Returns the x and y coordinates relatively to specified container
     */
    const getRelativePos = function (x, y, container) {
        let reference = container;
        let newPos = {
            x: x,
            y: y
        }
        while (reference) {
            newPos.x -= reference.offsetLeft;
            newPos.y -= reference.offsetTop;
            reference = reference.offsetParent;
        }
        return newPos;
    };

    /**
     * This method prevents event from further bubbling.
     */
    const tearDownEvent = function (e) {
        if (e) {
            if (e.stopPropagation) e.stopPropagation();
            if (e.preventDefault) e.preventDefault();
            e.cancelBubble = true;
            e.returnValue = false;
        }
    };
    
    /**
     * Makes color lighter or darker depending on whether lum parameter is greater or less then 0.
     */
    const shadeColor = function (hex, lum) {
        if (hex != null) {
            hex = String(hex).replace(/[^0-9a-f]/gi, '');
            if (hex.length < 6) {
                hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
            }
            lum = lum || 0;
            var c, i, rgb = "#";
            for (i = 0; i < 3; i++) {
                c = parseInt(hex.substr(i * 2, 2), 16);
                c = Math.round(Math.min(Math.max(0, c + (c * lum)), 255)).toString(16);
                rgb += ("00" + c).substr(c.length);
            }
            return rgb;
        } else {
            return hex;
        }
    };

    /**
     * Returns true if the descendant is has parent as ancestor, otherwise returns false.
     */
    const isInHierarchy = function (parent, descendant) {
        let current = descendant;
        while (current !== null && current !== parent) {
            current = current.parentElement;
        }
        return current !== null;
    };

    /**
     * The class that can be used like an entity for entity grid inspector or any other place.
     */
    class EntityStub {

        constructor(id) {
            this['id'] = id;
        }

        get(prop) {
            if (prop === '') { // empty property name means 'entity itself'
                return this;
            }
            const dotIndex = prop.indexOf(".");
            if (dotIndex > -1) {
                var first = prop.slice(0, dotIndex);
                var rest = prop.slice(dotIndex + 1);
                var firstVal = this[first];
                if (firstVal === null) {
                    return null;
                }
                return firstVal.get(rest);
            }
            return this[prop];
        }

        set(property, value) {
            this[property] = value;
        }

        type() {
            return {
                prop: (prop) => {
                    return {
                        scale: () => 0,
                        trailingZeros: () => true
                    }
                }
            }
        }

        prop(propName) {
            return {
                validationResult: () => null
            }
        }
    }
</script>