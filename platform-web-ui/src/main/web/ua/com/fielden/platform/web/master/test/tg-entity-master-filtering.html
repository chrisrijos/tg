<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title>entity-master tests for data filtering (commonly, user-driven filtering)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

    <script src="/resources/polymer/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
    <script src='/resources/polymer/web-animations-js/web-animations-next-lite.min.js'></script>
    <script src="/resources/filesaver/FileSaver.min.js"></script>
    <script src="/resources/polymer/wct-browser-legacy/browser.js"></script>
</head>

<body>
    <tg-reflector id="reflector"></tg-reflector>
    <test-fixture id="MasterFixture">
        <template>
            <tg-tgPersistentEntityWithProperties-master
                id="master"
                entity-type="ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties"
                entity-id="new"
                current-state="EDIT"
            ></tg-tgPersistentEntityWithProperties-master>
        </template>
    </test-fixture>
    
    <script type="module">
        import '/app/tg-reflector.js';
        import '/master_ui/ua.com.fielden.platform.sample.domain.TgPersistentEntityWithProperties';
        
        suite('entity master filtering', function () {
            let master, reflector;
            
            setup(function () {
                master = fixture('MasterFixture');
                reflector = document.querySelector('#reflector');
            });
            
            test('works for master knowing its entityId explicitly', function (done) {
                master.postRetrieved = function (entity, bindingEntity, customObject) {
                    assert.strictEqual(entity, null, 'The entity returned in master after retrieval should be empty -- FILTERED instance should be filtered out.');
                    done();
                };
                master.entityId = '83';
                master.retrieve();
            });
            
        });
    </script>
    
</body>
</html>
